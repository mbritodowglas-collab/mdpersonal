{% if page.af_rendered %}{% assign __skip = true %}{% endif %}
{% unless __skip %}
{% assign page.af_rendered = true %}

<section class="afiliados">
  <h3>Produtos que recomendo</h3>

  {%- comment -%}
    Regra:
    - Se 'page.afiliados' existir → usa esses itens.
    - Senão → pega 1 item do catálogo pela 1ª categoria (fallback: default)
             + 2 fixos (Shopee e Fit House).
  {%- endcomment -%}

  {% if page.afiliados and page.afiliados.size > 0 %}
    {% assign todos = page.afiliados %}
  {% else %}
    {% assign cat = page.categories | first | default: 'default' %}
    {% assign cat_list = site.data.afiliados[cat] | default: site.data.afiliados.default %}
    {% assign primeiro = cat_list | first %}

    {% assign todos = "" | split: "" %}
    {% if primeiro %}{% assign todos = todos | push: primeiro %}{% endif %}

    {% assign shopee =  {
      "title": "Shopee — Acessórios & Suplementos",
      "url": site.shoppee_link | default: "https://shopee.com.br/",
      "image": "/assets/img/af/shopee.jpg",
      "note": "Seleção com ótimo custo-benefício."
    } %}

    {% assign fhouse = {
      "title": "Fit House — Suplementos",
      "url": site.fithouse_link | default: "https://www.fithouse.com.br/",
      "image": "/assets/img/af/fithouse.jpg",
      "note": "Parceiro recomendado para qualidade."
    } %}

    {% assign todos = todos | push: shopee | push: fhouse %}
  {% endif %}

  <div class="af-grid">
    {% for it in todos %}
      <a class="af-card" href="{{ it.url }}" target="_blank" rel="noopener">
        <span class="af-thumb"
              style="background-image:url('{{ it.image | default: site.default_af_thumb | default: "/assets/img/af/default.jpg" | relative_url }}')"></span>
        <span class="af-info">
          <strong>{{ it.title }}</strong>
          {% if it.note %}<span class="af-note">{{ it.note }}</span>{% endif %}
          <span class="af-cta">Ver detalhes →</span>
        </span>
      </a>
    {% endfor %}
  </div>
</section>

{% endunless %}
